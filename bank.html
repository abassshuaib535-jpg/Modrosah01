<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Banking Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
    }
    * {
      font-family: 'DM Sans', sans-serif;
    }
    .gradient-card {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
    }
    .glass-card {
      background: rgba(255, 255, 255, 0.03);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.08);
    }
    .stat-glow {
      box-shadow: 0 0 40px rgba(99, 102, 241, 0.15);
    }
    .scrollbar-thin::-webkit-scrollbar {
      width: 4px;
    }
    .scrollbar-thin::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
    }
    .scrollbar-thin::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.2);
      border-radius: 2px;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-fade-in {
      animation: fadeIn 0.4s ease-out forwards;
    }
    .transaction-item {
      animation: fadeIn 0.3s ease-out forwards;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full">
  <div id="app" class="h-full w-full overflow-auto gradient-card text-white"><!-- Header -->
   <header class="px-6 py-4 border-b border-white/10">
    <div class="max-w-7xl mx-auto flex items-center justify-between">
     <div class="flex items-center gap-3">
      <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center">
       <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
       </svg>
      </div>
      <h1 id="bank-name" class="text-xl font-bold">Ibnabass Bank</h1>
     </div>
     <div class="flex items-center gap-4"><button class="p-2 rounded-lg hover:bg-white/10 transition-colors">
       <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
       </svg></button>
      <div class="w-9 h-9 rounded-full bg-gradient-to-br from-emerald-400 to-cyan-500 flex items-center justify-center text-sm font-semibold"><span id="user-initials">AS</span>
      </div>
     </div>
    </div>
   </header><!-- Main Content -->
   <main class="px-6 py-6 max-w-7xl mx-auto"><!-- Welcome Section -->
    <div class="mb-8 animate-fade-in">
     <p class="text-gray-400 text-sm" id="welcome-message">Welcome back,</p>
     <h2 class="text-2xl font-bold mt-1" id="account-holder">Abass Shuaib</h2>
    </div><!-- Balance Cards -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8"><!-- Total Balance -->
     <div class="glass-card rounded-2xl p-6 stat-glow animate-fade-in" style="animation-delay: 0.1s">
      <div class="flex items-center justify-between mb-4"><span class="text-gray-400 text-sm">Total Balance</span>
       <div class="w-8 h-8 rounded-lg bg-indigo-500/20 flex items-center justify-center">
        <svg class="w-4 h-4 text-indigo-400" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
        </svg>
       </div>
      </div>
      <p class="text-3xl font-bold" id="total-balance">$0.00</p>
      <p class="text-emerald-400 text-sm mt-2 flex items-center gap-1">
       <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
       </svg> Account Active</p>
     </div><!-- Income -->
     <div class="glass-card rounded-2xl p-6 animate-fade-in" style="animation-delay: 0.2s">
      <div class="flex items-center justify-between mb-4"><span class="text-gray-400 text-sm">Total Income</span>
       <div class="w-8 h-8 rounded-lg bg-emerald-500/20 flex items-center justify-center">
        <svg class="w-4 h-4 text-emerald-400" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 11l5-5m0 0l5 5m-5-5v12" />
        </svg>
       </div>
      </div>
      <p class="text-3xl font-bold text-emerald-400" id="total-income">$0.00</p>
      <p class="text-gray-500 text-sm mt-2">This period</p>
     </div><!-- Expenses -->
     <div class="glass-card rounded-2xl p-6 animate-fade-in" style="animation-delay: 0.3s">
      <div class="flex items-center justify-between mb-4"><span class="text-gray-400 text-sm">Total Expenses</span>
       <div class="w-8 h-8 rounded-lg bg-rose-500/20 flex items-center justify-center">
        <svg class="w-4 h-4 text-rose-400" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 13l-5 5m0 0l-5-5m5 5V6" />
        </svg>
       </div>
      </div>
      <p class="text-3xl font-bold text-rose-400" id="total-expenses">$0.00</p>
      <p class="text-gray-500 text-sm mt-2">This period</p>
     </div>
    </div><!-- Main Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6"><!-- Left Column - Transactions -->
     <div class="lg:col-span-2 space-y-6"><!-- Quick Actions -->
      <div class="glass-card rounded-2xl p-6 animate-fade-in" style="animation-delay: 0.4s">
       <h3 class="text-lg font-semibold mb-4">Quick Actions</h3>
       <div class="grid grid-cols-4 gap-3"><button onclick="openModal('deposit')" class="flex flex-col items-center gap-2 p-4 rounded-xl bg-emerald-500/10 hover:bg-emerald-500/20 transition-all group">
         <div class="w-10 h-10 rounded-full bg-emerald-500/20 flex items-center justify-center group-hover:scale-110 transition-transform">
          <svg class="w-5 h-5 text-emerald-400" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
          </svg>
         </div><span class="text-xs text-gray-300">Deposit</span> </button> <button onclick="openModal('withdraw')" class="flex flex-col items-center gap-2 p-4 rounded-xl bg-rose-500/10 hover:bg-rose-500/20 transition-all group">
         <div class="w-10 h-10 rounded-full bg-rose-500/20 flex items-center justify-center group-hover:scale-110 transition-transform">
          <svg class="w-5 h-5 text-rose-400" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4" />
          </svg>
         </div><span class="text-xs text-gray-300">Withdraw</span> </button> <button onclick="openModal('transfer')" class="flex flex-col items-center gap-2 p-4 rounded-xl bg-indigo-500/10 hover:bg-indigo-500/20 transition-all group">
         <div class="w-10 h-10 rounded-full bg-indigo-500/20 flex items-center justify-center group-hover:scale-110 transition-transform">
          <svg class="w-5 h-5 text-indigo-400" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" />
          </svg>
         </div><span class="text-xs text-gray-300">Transfer</span> </button> <button onclick="openModal('payment')" class="flex flex-col items-center gap-2 p-4 rounded-xl bg-amber-500/10 hover:bg-amber-500/20 transition-all group">
         <div class="w-10 h-10 rounded-full bg-amber-500/20 flex items-center justify-center group-hover:scale-110 transition-transform">
          <svg class="w-5 h-5 text-amber-400" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" />
          </svg>
         </div><span class="text-xs text-gray-300">Payment</span> </button>
       </div>
      </div><!-- Recent Transactions -->
      <div class="glass-card rounded-2xl p-6 animate-fade-in" style="animation-delay: 0.5s">
       <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-semibold">Recent Transactions</h3><span class="text-sm text-gray-400" id="transaction-count">0 transactions</span>
       </div>
       <div id="transactions-list" class="space-y-3 max-h-80 overflow-y-auto scrollbar-thin">
        <div class="text-center py-8 text-gray-500">
         <svg class="w-12 h-12 mx-auto mb-3 opacity-50" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
         </svg>
         <p>No transactions yet</p>
         <p class="text-sm mt-1">Start by making a deposit</p>
        </div>
       </div>
      </div>
     </div><!-- Right Column - Clients & Stats -->
     <div class="space-y-6"><!-- Employers/Clients -->
      <div class="glass-card rounded-2xl p-6 animate-fade-in" style="animation-delay: 0.6s">
       <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-semibold">Clients &amp; Employers</h3><button onclick="openModal('client')" class="text-indigo-400 hover:text-indigo-300 transition-colors">
         <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
         </svg></button>
       </div>
       <div id="clients-list" class="space-y-3"><!-- Sample clients -->
        <div class="flex items-center gap-3 p-3 rounded-xl bg-white/5 hover:bg-white/10 transition-colors">
         <div class="w-10 h-10 rounded-full bg-gradient-to-br from-violet-500 to-purple-600 flex items-center justify-center text-sm font-semibold">
          AC
         </div>
         <div class="flex-1 min-w-0">
          <p class="font-medium truncate">Acme Corporation</p>
          <p class="text-xs text-gray-400">Employer</p>
         </div><span class="text-emerald-400 text-sm font-medium">Active</span>
        </div>
        <div class="flex items-center gap-3 p-3 rounded-xl bg-white/5 hover:bg-white/10 transition-colors">
         <div class="w-10 h-10 rounded-full bg-gradient-to-br from-cyan-500 to-blue-600 flex items-center justify-center text-sm font-semibold">
          TI
         </div>
         <div class="flex-1 min-w-0">
          <p class="font-medium truncate">Tech Industries</p>
          <p class="text-xs text-gray-400">Client</p>
         </div><span class="text-emerald-400 text-sm font-medium">Active</span>
        </div>
        <div class="flex items-center gap-3 p-3 rounded-xl bg-white/5 hover:bg-white/10 transition-colors">
         <div class="w-10 h-10 rounded-full bg-gradient-to-br from-amber-500 to-orange-600 flex items-center justify-center text-sm font-semibold">
          GS
         </div>
         <div class="flex-1 min-w-0">
          <p class="font-medium truncate">Global Services</p>
          <p class="text-xs text-gray-400">Client</p>
         </div><span class="text-amber-400 text-sm font-medium">Pending</span>
        </div>
       </div>
      </div><!-- Account Summary -->
      <div class="glass-card rounded-2xl p-6 animate-fade-in" style="animation-delay: 0.7s">
       <h3 class="text-lg font-semibold mb-4">Account Summary</h3>
       <div class="space-y-4">
        <div class="flex items-center justify-between"><span class="text-gray-400 text-sm">Account Type</span> <span class="font-medium">Premium Checking</span>
        </div>
        <div class="flex items-center justify-between"><span class="text-gray-400 text-sm">Account Number</span> <span class="font-medium font-mono">****4892</span>
        </div>
        <div class="flex items-center justify-between"><span class="text-gray-400 text-sm">Routing Number</span> <span class="font-medium font-mono">****1234</span>
        </div>
        <div class="flex items-center justify-between"><span class="text-gray-400 text-sm">Status</span> <span class="px-2 py-1 rounded-full bg-emerald-500/20 text-emerald-400 text-xs font-medium">Verified</span>
        </div>
       </div>
      </div><!-- Spending by Category -->
      <div class="glass-card rounded-2xl p-6 animate-fade-in" style="animation-delay: 0.8s">
       <h3 class="text-lg font-semibold mb-4">Spending Categories</h3>
       <div id="categories-chart" class="space-y-3">
        <div class="text-center py-4 text-gray-500 text-sm">
         <p>No spending data yet</p>
        </div>
       </div>
      </div>
     </div>
    </div>
   </main><!-- Transaction Modal -->
   <div id="modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden items-center justify-center z-50 p-4">
    <div class="glass-card rounded-2xl p-6 w-full max-w-md animate-fade-in">
     <div class="flex items-center justify-between mb-6">
      <h3 id="modal-title" class="text-xl font-semibold">New Transaction</h3><button onclick="closeModal()" class="p-2 rounded-lg hover:bg-white/10 transition-colors">
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
       </svg></button>
     </div>
     <form id="transaction-form" class="space-y-4"><input type="hidden" id="transaction-type" value="">
      <div><label for="amount" class="block text-sm text-gray-400 mb-2">Amount ($)</label> <input type="number" id="amount" step="0.01" min="0.01" required class="w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 focus:border-indigo-500 focus:outline-none transition-colors text-white placeholder-gray-500" placeholder="0.00">
      </div>
      <div id="recipient-field" class="hidden"><label for="recipient" class="block text-sm text-gray-400 mb-2">Recipient</label> <input type="text" id="recipient" class="w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 focus:border-indigo-500 focus:outline-none transition-colors text-white placeholder-gray-500" placeholder="Enter recipient name">
      </div>
      <div><label for="description" class="block text-sm text-gray-400 mb-2">Description</label> <input type="text" id="description" required class="w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 focus:border-indigo-500 focus:outline-none transition-colors text-white placeholder-gray-500" placeholder="Enter description">
      </div>
      <div><label for="category" class="block text-sm text-gray-400 mb-2">Category</label> <select id="category" required class="w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 focus:border-indigo-500 focus:outline-none transition-colors text-white"> <option value="salary">üíº Salary</option> <option value="business">üìä Business</option> <option value="shopping">üõí Shopping</option> <option value="food">üçî Food &amp; Dining</option> <option value="transport">üöó Transport</option> <option value="utilities">üí° Utilities</option> <option value="entertainment">üé¨ Entertainment</option> <option value="other">üìå Other</option> </select>
      </div><button type="submit" id="submit-btn" class="w-full py-3 rounded-xl bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 font-semibold transition-all transform hover:scale-[1.02] disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"> Complete Transaction </button>
     </form><!-- Delete Confirmation -->
     <div id="delete-confirm" class="hidden">
      <p class="text-gray-300 mb-4">Are you sure you want to delete this transaction?</p>
      <div class="flex gap-3"><button onclick="closeModal()" class="flex-1 py-3 rounded-xl bg-white/10 hover:bg-white/20 font-medium transition-colors">Cancel</button> <button id="confirm-delete-btn" class="flex-1 py-3 rounded-xl bg-rose-500 hover:bg-rose-600 font-medium transition-colors">Delete</button>
      </div>
     </div>
    </div>
   </div><!-- Toast Notification -->
   <div id="toast" class="fixed bottom-4 right-4 transform translate-y-20 opacity-0 transition-all duration-300 z-50">
    <div class="glass-card rounded-xl px-6 py-4 flex items-center gap-3">
     <div id="toast-icon" class="w-8 h-8 rounded-full flex items-center justify-center"></div>
     <p id="toast-message" class="font-medium"></p>
    </div>
   </div><!-- Limit Warning Banner -->
   <div id="limit-warning" class="hidden fixed top-0 left-0 right-0 bg-amber-500/90 text-black px-4 py-3 text-center font-medium z-50">
    ‚ö†Ô∏è Maximum transaction limit (999) reached. Please delete some transactions to add more.
   </div>
  </div>
  <script>
    // Default configuration
    const defaultConfig = {
      bank_name: 'NexusBank',
      welcome_message: 'Welcome back,',
      account_holder: 'John Doe',
      primary_color: '#6366f1',
      secondary_color: '#1e1e2e',
      text_color: '#ffffff',
      accent_color: '#10b981',
      muted_color: '#9ca3af',
      font_family: 'DM Sans',
      font_size: 16
    };

    let config = { ...defaultConfig };
    let transactions = [];
    let currentDeleteId = null;
    let isLoading = false;

    // Category colors for spending chart
    const categoryColors = {
      salary: '#10b981',
      business: '#6366f1',
      shopping: '#f59e0b',
      food: '#ef4444',
      transport: '#3b82f6',
      utilities: '#8b5cf6',
      entertainment: '#ec4899',
      other: '#6b7280'
    };

    const categoryEmojis = {
      salary: 'üíº',
      business: 'üìä',
      shopping: 'üõí',
      food: 'üçî',
      transport: 'üöó',
      utilities: 'üí°',
      entertainment: 'üé¨',
      other: 'üìå'
    };

    // Format currency
    function formatCurrency(amount) {
      return new Intl.NumberFormat('en-US', {
        style: 'currency',
        currency: 'USD'
      }).format(amount);
    }

    // Format date
    function formatDate(dateString) {
      const date = new Date(dateString);
      return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
    }

    // Calculate balances
    function calculateBalances() {
      let income = 0;
      let expenses = 0;

      transactions.forEach(t => {
        if (t.type === 'deposit' || t.type === 'income') {
          income += t.amount;
        } else {
          expenses += t.amount;
        }
      });

      return {
        total: income - expenses,
        income,
        expenses
      };
    }

    // Update balance display
    function updateBalances() {
      const { total, income, expenses } = calculateBalances();
      document.getElementById('total-balance').textContent = formatCurrency(total);
      document.getElementById('total-income').textContent = formatCurrency(income);
      document.getElementById('total-expenses').textContent = formatCurrency(expenses);
    }

    // Update transaction count
    function updateTransactionCount() {
      const count = transactions.length;
      document.getElementById('transaction-count').textContent = `${count} transaction${count !== 1 ? 's' : ''}`;
      
      // Show/hide limit warning
      const warning = document.getElementById('limit-warning');
      if (count >= 999) {
        warning.classList.remove('hidden');
      } else {
        warning.classList.add('hidden');
      }
    }

    // Render transactions list
    function renderTransactions() {
      const container = document.getElementById('transactions-list');
      
      if (transactions.length === 0) {
        container.innerHTML = `
          <div class="text-center py-8 text-gray-500">
            <svg class="w-12 h-12 mx-auto mb-3 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
            </svg>
            <p>No transactions yet</p>
            <p class="text-sm mt-1">Start by making a deposit</p>
          </div>
        `;
        return;
      }

      // Sort by date, newest first
      const sorted = [...transactions].sort((a, b) => new Date(b.date) - new Date(a.date));

      const existingItems = new Map(
        [...container.children].map(el => [el.dataset.transactionId, el])
      );

      sorted.forEach((t, index) => {
        const isIncome = t.type === 'deposit' || t.type === 'income';
        const amountClass = isIncome ? 'text-emerald-400' : 'text-rose-400';
        const amountPrefix = isIncome ? '+' : '-';
        const bgColor = categoryColors[t.category] || categoryColors.other;

        if (existingItems.has(t.__backendId)) {
          const existing = existingItems.get(t.__backendId);
          existing.querySelector('.amount').textContent = `${amountPrefix}${formatCurrency(t.amount)}`;
          existing.querySelector('.description').textContent = t.description;
          existing.querySelector('.date').textContent = formatDate(t.date);
          existingItems.delete(t.__backendId);
        } else {
          const item = document.createElement('div');
          item.dataset.transactionId = t.__backendId;
          item.className = 'transaction-item flex items-center gap-3 p-3 rounded-xl bg-white/5 hover:bg-white/10 transition-colors group';
          item.style.animationDelay = `${index * 0.05}s`;
          item.innerHTML = `
            <div class="w-10 h-10 rounded-full flex items-center justify-center text-lg" style="background: ${bgColor}20">
              ${categoryEmojis[t.category] || 'üìå'}
            </div>
            <div class="flex-1 min-w-0">
              <p class="font-medium truncate description">${t.description}</p>
              <p class="text-xs text-gray-400 date">${formatDate(t.date)}${t.recipient ? ` ‚Ä¢ ${t.recipient}` : ''}</p>
            </div>
            <div class="text-right">
              <p class="font-semibold ${amountClass} amount">${amountPrefix}${formatCurrency(t.amount)}</p>
              <p class="text-xs text-gray-500 capitalize">${t.type}</p>
            </div>
            <button onclick="confirmDelete('${t.__backendId}')" class="p-2 rounded-lg opacity-0 group-hover:opacity-100 hover:bg-white/10 transition-all text-gray-400 hover:text-rose-400">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
              </svg>
            </button>
          `;
          container.appendChild(item);
        }
      });

      existingItems.forEach(el => el.remove());
    }

    // Render spending categories chart
    function renderCategories() {
      const container = document.getElementById('categories-chart');
      
      const expensesByCategory = {};
      let totalExpenses = 0;

      transactions.forEach(t => {
        if (t.type !== 'deposit' && t.type !== 'income') {
          expensesByCategory[t.category] = (expensesByCategory[t.category] || 0) + t.amount;
          totalExpenses += t.amount;
        }
      });

      if (totalExpenses === 0) {
        container.innerHTML = `
          <div class="text-center py-4 text-gray-500 text-sm">
            <p>No spending data yet</p>
          </div>
        `;
        return;
      }

      const sorted = Object.entries(expensesByCategory)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 5);

      container.innerHTML = sorted.map(([category, amount]) => {
        const percentage = Math.round((amount / totalExpenses) * 100);
        const color = categoryColors[category] || categoryColors.other;
        
        return `
          <div>
            <div class="flex items-center justify-between mb-1">
              <span class="text-sm capitalize flex items-center gap-2">
                ${categoryEmojis[category] || 'üìå'} ${category}
              </span>
              <span class="text-sm text-gray-400">${percentage}%</span>
            </div>
            <div class="h-2 bg-white/10 rounded-full overflow-hidden">
              <div class="h-full rounded-full transition-all duration-500" style="width: ${percentage}%; background: ${color}"></div>
            </div>
          </div>
        `;
      }).join('');
    }

    // Open modal
    function openModal(type) {
      const modal = document.getElementById('modal');
      const form = document.getElementById('transaction-form');
      const deleteConfirm = document.getElementById('delete-confirm');
      const title = document.getElementById('modal-title');
      const recipientField = document.getElementById('recipient-field');
      const transactionType = document.getElementById('transaction-type');

      form.classList.remove('hidden');
      deleteConfirm.classList.add('hidden');

      const titles = {
        deposit: 'üí∞ Make a Deposit',
        withdraw: 'üí∏ Withdraw Funds',
        transfer: '‚ÜîÔ∏è Transfer Money',
        payment: 'üí≥ Make a Payment',
        client: 'üë§ Add Client Income'
      };

      title.textContent = titles[type] || 'New Transaction';
      transactionType.value = type;

      if (type === 'transfer' || type === 'payment') {
        recipientField.classList.remove('hidden');
        document.getElementById('recipient').required = true;
      } else {
        recipientField.classList.add('hidden');
        document.getElementById('recipient').required = false;
      }

      // Reset form
      document.getElementById('amount').value = '';
      document.getElementById('description').value = '';
      document.getElementById('recipient').value = '';
      document.getElementById('category').value = type === 'deposit' || type === 'client' ? 'salary' : 'other';

      modal.classList.remove('hidden');
      modal.classList.add('flex');
    }

    // Close modal
    function closeModal() {
      const modal = document.getElementById('modal');
      modal.classList.add('hidden');
      modal.classList.remove('flex');
      currentDeleteId = null;
    }

    // Confirm delete
    function confirmDelete(id) {
      currentDeleteId = id;
      const modal = document.getElementById('modal');
      const form = document.getElementById('transaction-form');
      const deleteConfirm = document.getElementById('delete-confirm');
      const title = document.getElementById('modal-title');

      title.textContent = 'üóëÔ∏è Delete Transaction';
      form.classList.add('hidden');
      deleteConfirm.classList.remove('hidden');

      modal.classList.remove('hidden');
      modal.classList.add('flex');
    }

    // Show toast
    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      const toastMessage = document.getElementById('toast-message');
      const toastIcon = document.getElementById('toast-icon');

      toastMessage.textContent = message;

      if (type === 'success') {
        toastIcon.innerHTML = '<svg class="w-5 h-5 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>';
        toastIcon.className = 'w-8 h-8 rounded-full flex items-center justify-center bg-emerald-500/20';
      } else {
        toastIcon.innerHTML = '<svg class="w-5 h-5 text-rose-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>';
        toastIcon.className = 'w-8 h-8 rounded-full flex items-center justify-center bg-rose-500/20';
      }

      toast.classList.remove('translate-y-20', 'opacity-0');
      toast.classList.add('translate-y-0', 'opacity-100');

      setTimeout(() => {
        toast.classList.add('translate-y-20', 'opacity-0');
        toast.classList.remove('translate-y-0', 'opacity-100');
      }, 3000);
    }

    // Handle form submission
    document.getElementById('transaction-form').addEventListener('submit', async (e) => {
      e.preventDefault();

      if (isLoading) return;

      // Check limit
      if (transactions.length >= 999) {
        showToast('Transaction limit reached (999)', 'error');
        return;
      }

      const submitBtn = document.getElementById('submit-btn');
      const type = document.getElementById('transaction-type').value;
      const amount = parseFloat(document.getElementById('amount').value);
      const description = document.getElementById('description').value;
      const category = document.getElementById('category').value;
      const recipient = document.getElementById('recipient').value;

      // Check balance for withdrawals/transfers/payments
      if ((type === 'withdraw' || type === 'transfer' || type === 'payment') && amount > calculateBalances().total) {
        showToast('Insufficient funds', 'error');
        return;
      }

      isLoading = true;
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<span class="inline-block animate-spin mr-2">‚è≥</span> Processing...';

      const transaction = {
        type: type === 'client' ? 'income' : type,
        amount,
        description,
        category,
        recipient: recipient || '',
        date: new Date().toISOString()
      };

      const result = await window.dataSdk.create(transaction);

      isLoading = false;
      submitBtn.disabled = false;
      submitBtn.textContent = 'Complete Transaction';

      if (result.isOk) {
        closeModal();
        showToast('Transaction completed successfully');
      } else {
        showToast('Transaction failed. Please try again.', 'error');
      }
    });

    // Handle delete confirmation
    document.getElementById('confirm-delete-btn').addEventListener('click', async () => {
      if (!currentDeleteId || isLoading) return;

      const btn = document.getElementById('confirm-delete-btn');
      isLoading = true;
      btn.disabled = true;
      btn.innerHTML = '<span class="inline-block animate-spin mr-2">‚è≥</span> Deleting...';

      const transaction = transactions.find(t => t.__backendId === currentDeleteId);
      if (transaction) {
        const result = await window.dataSdk.delete(transaction);
        
        if (result.isOk) {
          closeModal();
          showToast('Transaction deleted');
        } else {
          showToast('Failed to delete. Please try again.', 'error');
        }
      }

      isLoading = false;
      btn.disabled = false;
      btn.textContent = 'Delete';
    });

    // Data handler for SDK
    const dataHandler = {
      onDataChanged(data) {
        transactions = data;
        updateBalances();
        updateTransactionCount();
        renderTransactions();
        renderCategories();
      }
    };

    // Config change handler
    async function onConfigChange(cfg) {
      config = { ...defaultConfig, ...cfg };

      // Update text content
      document.getElementById('bank-name').textContent = config.bank_name || defaultConfig.bank_name;
      document.getElementById('welcome-message').textContent = config.welcome_message || defaultConfig.welcome_message;
      document.getElementById('account-holder').textContent = config.account_holder || defaultConfig.account_holder;

      // Update user initials
      const name = config.account_holder || defaultConfig.account_holder;
      const initials = name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);
      document.getElementById('user-initials').textContent = initials;

      // Apply font
      const font = config.font_family || defaultConfig.font_family;
      document.body.style.fontFamily = `'${font}', 'DM Sans', sans-serif`;

      // Apply font size scaling
      const baseSize = config.font_size || defaultConfig.font_size;
      document.documentElement.style.fontSize = `${baseSize}px`;
    }

    // Map to capabilities
    function mapToCapabilities(cfg) {
      return {
        recolorables: [
          {
            get: () => cfg.secondary_color || defaultConfig.secondary_color,
            set: (value) => {
              cfg.secondary_color = value;
              window.elementSdk.setConfig({ secondary_color: value });
            }
          },
          {
            get: () => cfg.primary_color || defaultConfig.primary_color,
            set: (value) => {
              cfg.primary_color = value;
              window.elementSdk.setConfig({ primary_color: value });
            }
          },
          {
            get: () => cfg.text_color || defaultConfig.text_color,
            set: (value) => {
              cfg.text_color = value;
              window.elementSdk.setConfig({ text_color: value });
            }
          },
          {
            get: () => cfg.accent_color || defaultConfig.accent_color,
            set: (value) => {
              cfg.accent_color = value;
              window.elementSdk.setConfig({ accent_color: value });
            }
          },
          {
            get: () => cfg.muted_color || defaultConfig.muted_color,
            set: (value) => {
              cfg.muted_color = value;
              window.elementSdk.setConfig({ muted_color: value });
            }
          }
        ],
        borderables: [],
        fontEditable: {
          get: () => cfg.font_family || defaultConfig.font_family,
          set: (value) => {
            cfg.font_family = value;
            window.elementSdk.setConfig({ font_family: value });
          }
        },
        fontSizeable: {
          get: () => cfg.font_size || defaultConfig.font_size,
          set: (value) => {
            cfg.font_size = value;
            window.elementSdk.setConfig({ font_size: value });
          }
        }
      };
    }

    // Map to edit panel values
    function mapToEditPanelValues(cfg) {
      return new Map([
        ['bank_name', cfg.bank_name || defaultConfig.bank_name],
        ['welcome_message', cfg.welcome_message || defaultConfig.welcome_message],
        ['account_holder', cfg.account_holder || defaultConfig.account_holder]
      ]);
    }

    // Initialize SDKs
    async function init() {
      // Initialize Element SDK
      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange,
          mapToCapabilities,
          mapToEditPanelValues
        });
      }

      // Initialize Data SDK
      if (window.dataSdk) {
        const result = await window.dataSdk.init(dataHandler);
        if (!result.isOk) {
          console.error('Failed to initialize data SDK');
        }
      }
    }

    init();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9bd3cc7160a5005f',t:'MTc2ODI5NTgyNi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>